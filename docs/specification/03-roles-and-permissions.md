# ロールと権限

## ロール一覧

### 1. システム管理者（admin）
**説明**: システム全体を管理する最高権限を持つロール

**権限**:
- すべての機能へのアクセス
- システム設定の変更
- 全店舗の管理
- 全ユーザーの管理
- アクティビティログの閲覧
- システム統計の閲覧

**アクセス可能な機能**:
- システム管理ダッシュボード
- 店舗管理（全店舗）
- ユーザー管理（全ユーザー）
- ロール・権限管理
- システム設定
- アクティビティログ

---

### 2. 店舗店長（shop_manager）
**説明**: 特定の店舗を管理する権限を持つロール

**権限**:
- 担当店舗の情報管理
- 担当店舗のメニュー管理
- 担当店舗の予約管理（作成・編集・削除・承認・却下）
- 担当店舗のスタイリスト管理
- 担当店舗のシフト管理
- 担当店舗の統計情報閲覧

**アクセス可能な機能**:
- 店舗管理ダッシュボード
- 店舗情報の編集
- メニュー管理
- 予約管理（承認・却下含む）
- スタイリスト管理
- シフト管理
- 店舗統計情報

**制限事項**:
- 他の店舗の情報は閲覧不可
- システム設定の変更不可

---

### 3. 店舗スタイリスト（shop_staff）
**説明**: 店舗スタイリストとして閲覧権限を持つロール

**権限**:
- 担当店舗のスタイリスト情報の閲覧
- 担当店舗の予約情報の閲覧
- 担当店舗のシフト情報の閲覧
- 自分のプロフィール情報の編集
- 自分の担当予約の確認

**アクセス可能な機能**:
- スタイリストダッシュボード
- 予約一覧・詳細の閲覧
- シフトカレンダーの閲覧
- スタイリスト一覧の閲覧
- 自分のプロフィール編集
- 自分の実績・評価の確認

**制限事項**:
- 予約の作成・編集・削除不可
- メニューの管理不可
- シフトの作成・編集不可
- 店舗情報の編集不可

---

### 4. 一般ユーザー（user）
**説明**: 予約を作成・管理できる一般ユーザー

**権限**:
- 店舗情報の閲覧
- メニュー情報の閲覧
- 予約の作成・編集・キャンセル（自分の予約のみ）
- マイページの利用
- 予約履歴の閲覧

**アクセス可能な機能**:
- 店舗一覧・詳細の閲覧
- メニュー一覧の閲覧
- 予約作成フォーム
- マイページ
- 予約履歴
- お気に入り店舗機能

**制限事項**:
- 店舗管理機能へのアクセス不可
- 他のユーザーの予約情報の閲覧不可
- スタッフ情報の詳細閲覧不可

---

### 5. ゲスト（guest）
**説明**: 認証不要で基本情報を閲覧できるユーザー

**権限**:
- 店舗情報の閲覧
- メニュー情報の閲覧
- 予約の作成（ゲスト予約）

**アクセス可能な機能**:
- トップページ
- 店舗一覧・詳細の閲覧
- メニュー一覧の閲覧
- ゲスト予約フォーム

**制限事項**:
- マイページへのアクセス不可
- 予約履歴の閲覧不可
- 予約の編集・キャンセル不可（予約確認メールからのみ可能）

---

## 権限の階層構造

```
システム管理者（admin）
  └─ 全権限

店舗店長（shop_manager）
  └─ 店舗管理権限
      ├─ 店舗情報管理
      ├─ メニュー管理
      ├─ 予約管理（承認・却下含む）
      ├─ スタッフ管理
      └─ シフト管理

店舗スタッフ（shop_staff）
  └─ 閲覧権限
      ├─ スタッフ情報閲覧
      ├─ 予約情報閲覧
      └─ シフト情報閲覧

一般ユーザー（user）
  └─ 予約権限
      ├─ 店舗情報閲覧
      ├─ メニュー情報閲覧
      ├─ 予約作成・管理
      └─ マイページ利用

ゲスト（guest）
  └─ 閲覧権限
      ├─ 店舗情報閲覧
      ├─ メニュー情報閲覧
      └─ ゲスト予約作成
```

## 権限管理の実装

### 使用パッケージ
- **Laravel Permission**: ロールと権限の管理

### 権限の命名規則
- `{resource}.{action}` 形式
- 例: `shops.view`, `shops.create`, `shops.edit`, `shops.delete`
- 例: `reservations.approve`, `reservations.reject`

### 主要な権限一覧

#### 店舗関連
- `shops.view` - 店舗情報の閲覧
- `shops.create` - 店舗の作成
- `shops.edit` - 店舗の編集
- `shops.delete` - 店舗の削除

#### メニュー関連
- `menus.view` - メニュー情報の閲覧
- `menus.create` - メニューの作成
- `menus.edit` - メニューの編集
- `menus.delete` - メニューの削除

#### 予約関連
- `reservations.view` - 予約情報の閲覧
- `reservations.create` - 予約の作成
- `reservations.edit` - 予約の編集
- `reservations.delete` - 予約の削除
- `reservations.approve` - 予約の承認
- `reservations.reject` - 予約の却下

#### スタイリスト関連
- `staff.view` - スタイリスト情報の閲覧
- `staff.create` - スタイリストの作成
- `staff.edit` - スタイリストの編集
- `staff.delete` - スタイリストの削除

#### シフト関連
- `shifts.view` - シフト情報の閲覧
- `shifts.create` - シフトの作成
- `shifts.edit` - シフトの編集
- `shifts.delete` - シフトの削除

#### システム管理関連
- `system.manage` - システム管理
- `users.manage` - ユーザー管理
- `logs.view` - ログ閲覧

#### 顧客管理関連
- `customers.view` - 顧客情報の閲覧
- `customers.create` - 顧客カードの作成
- `customers.edit` - 顧客情報の編集
- `customers.delete` - 顧客カードの削除

#### ポイント・クーポン関連
- `points.view` - ポイント情報の閲覧
- `points.manage` - ポイントの管理（付与・調整）
- `coupons.view` - クーポンの閲覧
- `coupons.create` - クーポンの作成
- `coupons.edit` - クーポンの編集
- `coupons.delete` - クーポンの削除

#### レビュー関連
- `reviews.view` - レビューの閲覧
- `reviews.create` - レビューの作成
- `reviews.approve` - レビューの承認
- `reviews.delete` - レビューの削除

#### 在庫管理関連
- `inventory.view` - 在庫情報の閲覧
- `inventory.manage` - 在庫の管理
- `inventory.transaction` - 在庫取引の記録

#### 売上管理関連
- `sales.view` - 売上情報の閲覧
- `sales.manage` - 売上の管理
- `sales.report` - 売上レポートの生成

---

## 現在実装中機能で利用する権限とロール対応（スコープ限定）

### 対象となる機能

- 一般ユーザー向け公開サイト:
  - トップページ表示
  - 店舗一覧の閲覧（`ShopList` 相当）
- 管理寄りの機能・開発者向け機能:
  - Telescope・Activity Log など、システム監視用途（※基本的に admin のみ）

### この段階で必要になる権限

- **店舗関連**
  - `shops.view`  
    - 店舗一覧・店舗情報を閲覧するために使用
- **ログ閲覧 / システム監視（開発・運用向け）**
  - `logs.view`  
    - Telescope や Activity Log を前提とした、ログ閲覧系の権限（本番では admin のみ付与を想定）

※ 予約作成やメニュー管理などは、現時点では未実装のためここでは対象外。

### ロールごとの権限割り当て（現時点の最小セット）

#### システム管理者（admin）

- **付与する権限（今回スコープ）**
  - `shops.view`
  - `logs.view`
- **想定**
  - 公開サイトの店舗一覧を確認できる
  - Telescope / Activity Log などでシステム状況・ログを確認できる

#### 店舗店長（shop_manager）

- **付与する権限（今回スコープ）**
  - `shops.view`
- **想定**
  - 自店舗・全店舗の一覧を確認できる（仕様に応じてスコープを制御）
  - ログ閲覧（`logs.view`）は原則付与しない（システム管理者の専用権限）

#### 店舗スタイリスト（shop_staff）

- **付与する権限（今回スコープ）**
  - `shops.view`（必要に応じて付与。店舗一覧を参照する要件がある場合のみ）
- **想定**
  - 今回実装している公開サイトの閲覧機能に直接の必須要件はないため、  
    具体的な業務画面が実装される段階で再評価する。

#### 一般ユーザー（user）

- **付与する権限（今回スコープ）**
  - `shops.view`
- **想定**
  - ログイン済みユーザーは、公開サイトの店舗一覧・店舗情報を閲覧可能。
  - 将来的に予約機能が実装された際には、`reservations.*` 系権限を追加で検討する。

#### ゲスト（guest）

- **付与する権限（今回スコープ）**
  - （ロールとしては作成せず、**未認証状態として扱う** 想定）
  - ルートやミドルウェア側で「認証不要でアクセス可能なページ」として制御する。
- **想定**
  - トップページや一部の店舗情報など、完全公開情報については権限チェックではなく  
    ルーティング・ミドルウェアレベルで公開/非公開を制御する方針とする。

